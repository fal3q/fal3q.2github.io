<!DOCTYPE html>
<html lang="en">
<head>
    <script src="https://cdn.jsdelivr.net/npm/comfy.js@latest/dist/comfy.min.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Timer</title>
    

    <style>
        @font-face {
        font-family: 'MC-font';
        src: url('MinecraftRegular-Bmg3.otf') format('truetype');
        font-weight: normal;
        font-style: normal;
        font-display: swap;
        }
        body {
            margin: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: transparent;
            overflow: hidden;
        }
        .Timer, .Deaths{
            color: white;
            -webkit-text-stroke: 3px black;
            font-size: 90px;
            letter-spacing: 5px;
            font-family: 'MC-font', serif;
        }
        .Boss{
            margin-top: 15px;

        }
        .TimerBoss, .DeathsBoss, .NameBoss{
            color: white;
            -webkit-text-stroke: 3px black;
            font-size: 90px;
            letter-spacing: 5px;
            font-family: 'MC-font', serif;
        }
    </style>
</head>
<body>
    <div class="Deaths">Smierci: 0</div>
    <div class="Timer">Time: 00:00</div>
    <div class="Boss" style="visibility: hidden;">
        <div class="NameBoss"></div>
        <div class="DeathsBoss"></div>
        <div class="TimerBoss"></div>
    </div>
    <script>
        //Glowny Timer + śmierci
    let Time = localStorage.getItem("timer_time") ? parseInt(localStorage.getItem("timer_time")) : 0;
    let Deaths = localStorage.getItem("Deaths_count") ? parseInt(localStorage.getItem("Deaths_count")) : 0;
    let isRunning = false;
    const display_deaths = document.querySelector(".Deaths");
    const display_time = document.querySelector(".Timer");
    
    
        //Boss Timer + śmierci
    let NameBoss = localStorage.getItem("timerBoss_name") || "" ;
    let TimeBoss = localStorage.getItem("timerBoss_time") ? parseInt(localStorage.getItem("timerBoss_time")) : 0;
    let DeathsBoss = localStorage.getItem("DeathsBoss_count") ? parseInt(localStorage.getItem("DeathsBoss_count")) : 0;
    let isRunningBoss = false;
    const fullboss = document.querySelector(".Boss");
    const display_name_boss = document.querySelector(".NameBoss");
    const display_deaths_boss = document.querySelector(".DeathsBoss");
    const display_time_boss = document.querySelector(".TimerBoss");

    if (NameBoss !== "") {
        fullboss.style.visibility = "visible";
    }

    updateDisplay();

    function updateDisplay() {
        let h = Math.floor(Time / 3600);
        let m = Math.floor((Time % 3600) / 60);
        let s = Math.floor(Time % 60);
        
        let hDisplay = h > 0 ? (h < 10 ? '0' + h : h) + ":" : "";
        let mDisplay = (m < 10 ? '0' + m : m) + ":";
        let sDisplay = s < 10 ? '0' + s : s;

        display_deaths.textContent = "Smierci: " + Deaths;
        display_time.textContent = "Time: " + hDisplay + mDisplay + sDisplay;

        localStorage.setItem("Deaths_count", Deaths);
        localStorage.setItem("timer_time", Time);
       
        
        
        if (document.querySelector(".Boss").style.visibility === "visible") {
                let hBoss = Math.floor(TimeBoss / 3600);
                let mBoss = Math.floor((TimeBoss % 3600) / 60);
                let sBoss = Math.floor(TimeBoss % 60);
                
                let hDisplayBoss = hBoss > 0 ? (hBoss < 10 ? '0' + hBoss : hBoss) + ":" : "";
                let mDisplayBoss = (mBoss < 10 ? '0' + mBoss : mBoss) + ":";
                let sDisplayBoss = sBoss < 10 ? '0' + sBoss : sBoss;

                localStorage.setItem("timerBoss_name",NameBoss)
                localStorage.setItem("DeathsBoss_count", DeathsBoss);
                localStorage.setItem("timerBoss_time", TimeBoss);
                
                display_name_boss.textContent = "Boss: " + NameBoss
                display_deaths_boss.textContent = "Smierci: " + DeathsBoss;
                display_time_boss.textContent = "Time: " + hDisplayBoss + mDisplayBoss + sDisplayBoss;
            }
    }

    function TimeUp() {
        if (isRunning) {
            Time++;
            updateDisplay();
        }
        if (document.querySelector(".Boss").style.visibility === "visible") {
            if (isRunningBoss) {
                TimeBoss++;
                updateDisplay();
            }
        }
    }

    function connectTwitch() {
        if (typeof ComfyJS !== "undefined") {
            ComfyJS.onCommand = (user, command, message, flags) => {
                if (flags.broadcaster || flags.mod) {
                    if (command === "tstart") {
                        isRunning = true;
                        if (document.querySelector(".Boss").style.visibility === "visible") {
                            isRunningBoss = true;
                        }
                    }
                    if (command === "tstop"){
                        isRunning = false;
                        if (document.querySelector(".Boss").style.visibility === "visible") {
                            isRunningBoss = false;
                        }
                    }
                    if (command === "tbossstart") {
                        if (message && message.trim().length > 0) {
                                document.querySelector(".Boss").style.visibility = "visible";
                                NameBoss = message.trim();
                                DeathsBoss = 0;
                                TimeBoss = 0;
                                isRunningBoss = true;
                                updateDisplay();
                            
                            }
                            else{
                                isRunningBoss = true;
                                updateDisplay();
                            }
                        }
                    if (command === "tbossstop") {
                        document.querySelector(".Boss").style.visibility = "hidden";
                        NameBoss = "";
                        DeathsBoss = 0;
                        TimeBoss = 0;
                        isRunningBoss = false;
                        updateDisplay();
                    }
                    if (command === "tbosspause"){
                        isRunningBoss = false;
                        updateDisplay();
                    }
                    if (command === "tsetdeaths" || command === "t++") {
                            let howMany = parseInt(message);
                            if (!isNaN(howMany)) {
                                Deaths = howMany;
                                updateDisplay();
                            }
                        }

                    if (command === "tset") {
                            let totalSeconds = 0;
                            if (message.includes(":")) {
                                const parts = message.split(":").map(Number);
                                if (parts.length === 3) totalSeconds = (parts[0] * 3600) + (parts[1] * 60) + parts[2];
                                else if (parts.length === 2) totalSeconds = (parts[0] * 60) + parts[1];
                            } else {
                                totalSeconds = parseInt(message);
                            }
                            
                            if (!isNaN(totalSeconds)) { 
                                Time = totalSeconds; 
                                updateDisplay(); 
                            }}
                    if (command === "t+"){
                        if (document.querySelector(".Boss").style.visibility === "visible") {  
                            Deaths++; DeathsBoss++; updateDisplay();
                        }
                        else{
                            Deaths++; updateDisplay();
                        }
                    }
                    
                    if (command === "t-") { 
                        if (document.querySelector(".Boss").style.visibility === "visible") {  
                        Deaths--; DeathsBoss--; updateDisplay(); 
                        }
                        else{
                            Deaths--; updateDisplay();
                        }
                    }
                    if (command === "treset") {
                        if (document.querySelector(".Boss").style.visibility === "visible") {  
                        Time = 0; TimeBoss = 0; updateDisplay(); 
                        }
                        else{
                            Time = 0;updateDisplay();
                        }}
                   }
            };
            ComfyJS.Init("damiano00o");
        } else {
            setTimeout(connectTwitch, 500);
        }
    }

    setInterval(TimeUp, 1000);
    connectTwitch();
</script>
</body>

</html>

